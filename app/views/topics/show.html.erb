<% title @topic.title %>

<div class="single-topic">

  <div class="topic">
    <div class="title">
      <h3><%= @topic.title %></h3>
    </div>
    <div class="meta">
      <div class="info">
        <div>
          <%= link_to @topic.node.name, node_path(@topic.node.slug), class: 'node-name' %>
          <span class="glyphicon glyphicon-time"></span> <span class="time"><%= timeago(@topic.created_at) %></span>
          <span class="glyphicon glyphicon-eye-open"></span> <span class="click"><%= @topic.clicks_count %> 次点击</span>
          <span class="glyphicon glyphicon-star-empty"></span> <span class="favourite">21 人收藏</span>
          <span class="reply-count"><%= @topic.replies_count %></span>
        </div>
      </div>
      <div class="author">
        <div class="avatar">
          <%= image_tag(@topic.author.avatar_url) %>
        </div>
        <div class="name"><%= link_to "#{@topic.author.nickname}", @topic.author %></div>
      </div>
    </div>
    <div class="content">
      <%= @topic.content %>
    </div>
  </div>

  <div class="toolbar">
    <div class="item">
      <a class="action" href="#">
        <span class="glyphicon glyphicon-star-empty"></span>
        <span>收藏</span>
      </a>
    </div>
    <div class="item">
      <a class="action" href="#">
        <span class="glyphicon glyphicon-thumbs-up"></span>
        <span>感谢</span>
      </a>
    </div>
    <div class="item float-right">
      <a class="action" href="#">
        <span class="glyphicon glyphicon-eye-close"></span>
        <span>忽略主题</span>
      </a>
    </div>
  </div>

  <div class="replies">
    <% @replies.each do |r| %>
        <%= div_for(r) do %>
            <div class="avatar">
              <%= image_tag(r.author.avatar_url, alt: r.author.id) %>
            </div>
            <div class="right-column">
              <div class="meta">
                <span class="author"><%= link_to "#{r.author.nickname}", r.author, class: 'name' %></span>
                <span class="time"><%= timeago(r.created_at) %></span>
                <span class="appreciation"><span class="glyphicon glyphicon-heart"></span><span class="count">3</span></span>

                <div class="actions">
                  <a class="action" href="#">
                    <span class="glyphicon glyphicon-thumbs-up"></span>
                    <span class="name">感谢</span>
                  </a>
                  <a class="action quote-reply" data-id="<%= r.id %>" href="#">
                    <span class="glyphicon glyphicon-comment"></span>
                    <span>回复</span>
                  </a>
                </div>
              </div>
              <% unless r.quoted_reply.nil? %>
                  <div class="quoted-reply">
                    <blockquote>

                      <p class="quoted-reply-meta">
                        引用 <%= link_to r.quoted_reply.author.nickname, r.quoted_reply.author %>
                        在 <span class="time"><%= timeago(r.quoted_reply.created_at) %></span> 的回复:
                      </p>

                      <div class="content">
                        <%= r.quoted_reply.content %>
                      </div>
                    </blockquote>
                  </div>
              <% end %>
              <div class="content">
                <%= r.content %>
              </div>
            </div>
        <% end %>
    <% end %>
  </div>

  <div class="row">
    <div class="col-md-12">
      <%= will_paginate @replies, renderer: BootstrapPagination::Rails %>
    </div>
    <div class="col-md-12" id="reply-form">
      <div class="panel panel-success">
        <div class="panel-heading">
          <h3 class="panel-title">发表回复</h3>
        </div>
        <div class="panel-body">
          <div class="quoted-reply in-reply-form" style="display: none">
            <blockquote>
              <p class="quoted-reply-meta">
                引用 <span class="author"></span>
                在 <span class="time"></span> 的回复:
                <a class="cancel float-right" href="#">取消</a>
              </p>

              <div class="content">

              </div>
            </blockquote>
          </div>

          <%= form_for(@topic.replies.new, url: topic_reply_index_path(@topic), html: {role: 'form'}) do |f| %>
              <div class="form-group">
                <div class="form-group">
                  <%= f.text_area :content, class: 'form-control', clos: '50', rows: '10' %>
                  <input name="quoted_reply_id" type="hidden" value="" />
                </div>
                <%= f.submit '回复', class: 'btn btn-success float-right' %>
              </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

</div>

